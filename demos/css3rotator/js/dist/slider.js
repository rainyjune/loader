!function(factory){var $="undefined"!=typeof Zepto?Zepto:jQuery;factory($)}(function($){function Css3Rotator(element,options){function init(){element.addClass("rotatorRootElement"),setSlideRootHeight(),slideContainer=element.find(mergedOptions.container),slideContainer.addClass("rotatorWrapper").addClass("flex-it"),addSliderItems(),slides=slideContainer.children(),slideCount=slides.length,mergedOptions.loop&&(addDuplicatePages(),slidePageIndex=1),slideDisplayCount=slideContainer.children().size();var slideContainerWidth=slideDisplayCount+"00%";mergedOptions.slideWidth!==element.width()&&(slideContainerWidth=mergedOptions.slideWidth*slideDisplayCount),slideContainer.width(slideContainerWidth),slidePageWidth=slideContainer.children().eq(0).width(),mergedOptions.loop&&(setTranslateXValue(-mergedOptions.slideWidth+"px"),currentTranslateXValue=-mergedOptions.slideWidth),addIndicator(),bindEvents(),setTimeout(function(){setTransitionDuration(),setAutoPlay()},0)}function setAutoPlay(){mergedOptions.autoPlay&&(timer=setTimeout(autoPlay,mergedOptions.transitonInterval))}function addSliderItems(){var dataSource=mergedOptions.dataSource;if(dataSource&&$.isArray(dataSource)){var items=[];$.each(dataSource,function(index,item){items.push(getSliderItemString(item))}),slideContainer.append(items.join(""))}}function getSliderItemString(itemData){var itemDom=$("#slider-item-template").clone().find("li");return itemDom.css("background-image","url("+itemData.img+")"),itemDom.find("a").attr("data-href",itemData.link),itemDom.find("h2").text(itemData.title),itemDom.prop("outerHTML")}function addDuplicatePages(){var oldPages=slideContainer.children(),firstOldPage=oldPages.eq(0),lastOldPage=oldPages.eq(-1);slideContainer.prepend(lastOldPage.clone()),slideContainer.append(firstOldPage.clone())}function prev(){slidePage(!1)}function next(){slidePage(!0)}function slidePage(isNext){updateSlideIndex(isNext),setTranslateXValue()}function autoPlay(){if(mergedOptions.autoPlay){if(autoPlayFinished)return window.clearTimeout(timer),!1;if(slidePageIndex===slideDisplayCount-1){if(!mergedOptions.loop)return autoPlayFinished=!0,window.clearTimeout(timer),!1;disableTransitionDuration(),slidePageIndex=1,setTranslateXValue(),setTimeout(function(){enableTransitionDuration(),next()},0)}else 0===slidePageIndex?(disableTransitionDuration(),mergedOptions.loop&&(slidePageIndex=slideDisplayCount-2,setTranslateXValue()),setTimeout(function(){enableTransitionDuration(),next()},0)):next()}}function updateSlideIndex(isNext){isNext?(slidePageIndex++,pageIndex===slideCount-1?pageIndex=0:pageIndex++):(slidePageIndex--,0===pageIndex?pageIndex=slideCount-1:pageIndex--)}function setTranslateXValue(value){value||(value=slidePageWidth*slidePageIndex,currentTranslateXValue=-value,value=currentTranslateXValue+"px"),isTranslate3dSupported?slideContainer.css({"-webkit-transform":"translate3d("+value+", 0, 0)","-moz-transform":"translate3d("+value+", 0, 0)","-o-transform":"translate3d("+value+", 0, 0)",transform:"translate3d("+value+", 0, 0)"}):slideContainer.css({"-webkit-transform":"translateX("+value+")","-moz-transform":"translateX("+value+")","-o-transform":"translateX("+value+")",transform:"translateX("+value+")"})}function transitionEndEventHandler(){return updateIndicatorStatus(),setAutoPlay(),!1}function bindEvents(){slideContainer.on(transitionEndEventName,transitionEndEventHandler);var count=0;$(window).on("orientationchange",handleOrientationChange),$(element).on("tapMy","a[data-href]",function(){return window.location=$(this).attr("data-href"),!1}),$(element).on("swipeMy",function(){enableTransitionDuration(),count=0,$("#debug").text("count:"+count)}),$(element).on("swipeLeftMy",function(){mergedOptions.loop||slidePageIndex!==slideDisplayCount-1?next():swipeCancelMyHandler()}),$(element).on("swipeRightMy",function(){mergedOptions.loop||0!==slidePageIndex?prev():swipeCancelMyHandler()}),$(element).on("swipeStartMy",function(){window.clearTimeout(timer);var nowTranslateXValue=getTranslateXValue(slideContainer[0]);if(currentTranslateXValue=nowTranslateXValue,disableTransitionDuration(),setTranslateXValue(nowTranslateXValue+"px"),console.log("x:"+nowTranslateXValue),!mergedOptions.loop)return!1;if(slidePageIndex===slideDisplayCount-1){slidePageIndex=1;var value=2*-mergedOptions.slideWidth+(slideContainer.width()+nowTranslateXValue);currentTranslateXValue=value,setTranslateXValue(value+"px"),console.log("slidePageIndex === slideDisplayCount -1, now:",currentTranslateXValue)}else if(0===slidePageIndex){slidePageIndex=slideDisplayCount-2;var value=-mergedOptions.slideWidth*slidePageIndex+nowTranslateXValue;currentTranslateXValue=value,setTranslateXValue(value+"px")}}),$(element).on("swipeCancelMy",swipeCancelMyHandler),$(element).on("swipeProgressMy",function(e,e1,e2){count++,setTranslateXValue(currentTranslateXValue+e1+"px"),$("#debug").text("count:"+count+" progrsss:"+(currentTranslateXValue+e1)+"px")})}function swipeCancelMyHandler(){enableTransitionDuration(),setTranslateXValue()}function handleOrientationChange(){return window.clearTimeout(timer),disableTransitionDuration(),setTimeout(function(){setSlideRootHeight(),slidePageWidth=slideContainer.children().eq(0).width(),setTranslateXValue(),updateIndicatorStatus(),setTimeout(function(){enableTransitionDuration(),setAutoPlay()},0)},500),!1}function setTransitionDuration(){slideContainer.css({"-webkit-transition-duration":mergedOptions.transitionDuration,"-moz-transition-duration":mergedOptions.transitionDuration,"-o-transition-duration":mergedOptions.transitionDuration,"transition-duration":mergedOptions.transitionDuration})}function disableTransitionDuration(){slideContainer.addClass("duration-initial")}function enableTransitionDuration(){slideContainer.removeClass("duration-initial")}function addIndicator(){for(var domStr="<strong class='indicator'>",i=0;slideCount>i;i++)domStr+="<span></span>";domStr+="</strong>",element.append(domStr),indicators=element.find(".indicator").children(),indicators.eq(0).addClass("current")}function updateIndicatorStatus(){indicators.removeClass("current"),indicators.eq(pageIndex).addClass("current")}function getSlideRootHeight(aspectRatio){return element.width()/aspectRatio}function setSlideRootHeight(){element.height(getSlideRootHeight(mergedOptions.aspectRatio))}var slidePageWidth,autoPlayFinished,defaults={container:".rotatorWrapper",transitionDuration:"5s",slideWidth:element.width(),aspectRatio:2,transitonInterval:"2000",pauseAfterTransition:!0,loop:!1,autoPlay:!0},isTranslate3dSupported=has3d(),currentTranslateXValue=null,mergedOptions=$.extend(defaults,options),transitionEndEventName=getTransitionEndEventName(),slideCount=0,pageIndex=0,slideDisplayCount=0,slidePageIndex=0,slideContainer=null,slides=null,indicators=null,timer=null;init()}function getTransitionEndEventName(){var i,undefined,el=document.createElement("div"),transitions={WebkitTransition:"webkitTransitionEnd",transition:"transitionend",OTransition:"otransitionend",MozTransition:"transitionend"};for(i in transitions)if(transitions.hasOwnProperty(i)&&el.style[i]!==undefined)return transitions[i];return""}function has3d(){var has3d,el=document.createElement("p"),transforms={webkitTransform:"-webkit-transform",OTransform:"-o-transform",msTransform:"-ms-transform",MozTransform:"-moz-transform",transform:"transform"};document.body.insertBefore(el,null);for(var t in transforms)void 0!==el.style[t]&&(el.style[t]="translate3d(1px,1px,1px)",has3d=window.getComputedStyle(el).getPropertyValue(transforms[t]));return document.body.removeChild(el),void 0!==has3d&&has3d.length>0&&"none"!==has3d}function getTranslateXValue(domElement){var cssMatrixObject=null;"undefined"!=typeof WebKitCSSMatrix?cssMatrixObject=WebKitCSSMatrix:"undefined"!=typeof MSCSSMatrix?cssMatrixObject=MSCSSMatrix:"undefined"!=typeof DOMMatrix&&(cssMatrixObject=DOMMatrix);var style=window.getComputedStyle(domElement),matrixString="";"undefined"!=typeof style.webkitTransform?matrixString=style.webkitTransform:"undefined"!=typeof style.mozTransform?matrixString=style.mozTransform:"undefined"!=typeof style.transform&&(matrixString=style.transform);var matrix=new cssMatrixObject(matrixString);return matrix.m41}$.fn.css3Rotator=function(options){return this.each(function(index,item){new Css3Rotator($(item),options)})}});